@model List<PorSaludApp.Models.Cliente>

@{
    ViewBag.Title = "Lista de Clientes";
    int currentPage = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;
    int totalRecords = ViewBag.TotalRecords ?? 0;
    int pageSize = ViewBag.PageSize ?? 10;

    // Calcular páginas a mostrar (máximo 7: actual + 3 a cada lado)
    int startPage = Math.Max(1, currentPage - 3);
    int endPage = Math.Min(totalPages, startPage + 6);
    if (endPage - startPage < 6)
    {
        startPage = Math.Max(1, endPage - 6);
    }
}

<div class="container mt-4">
    <h2 class="text-center mb-4" >📋 Lista de Clientes</h2>

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger">@ViewBag.Error</div>
    }

    <!-- Selector de registros por página -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="d-flex align-items-center">
                <label for="pageSize" class="me-2 mb-0">Mostrar:</label>
                <select class="form-select form-select-sm" id="pageSize" style="width: auto;">
                    <option value="10" @(pageSize == 10 ? "selected" : "")>10</option>
                    <option value="20" @(pageSize == 20 ? "selected" : "")>20</option>
                    <option value="50" @(pageSize == 50 ? "selected" : "")>50</option>
                    <option value="100" @(pageSize == 100 ? "selected" : "")>100</option>
                </select>
                <span class="ms-2">registros</span>
            </div>
        </div>
        <div class="col-md-6">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Buscar cliente..." aria-label="Buscar cliente">
                <button class="btn btn-outline-secondary" type="button">🔍 Buscar</button>
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Identidad</th>
                    <th>Nombre Completo</th>
                    <th>Teléfono</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.ClienteId</td>
                            <td>@item.Identidad</td>
                            <td>@item.NombreCompleto</td>
                            <td>@item.Telefono</td>
                            <td>
                                <span class="badge @(item.Estado ? "bg-success" : "bg-danger")">
                                    @(item.Estado ? "Activo" : "Inactivo")
                                </span>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    @Html.ActionLink("✏️ Editar", "EditarCliente", new { id = item.ClienteId },
                                        new { @class = "btn btn-warning" })

                                    @Html.ActionLink("📄 Documentos", "Index", "Documentos",
                                    new { Id = item.ClienteId }, new { @class = "btn btn-info" })
                                </div>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            No se encontraron clientes registrados
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @if (totalPages > 1)
    {
        <div class="d-flex justify-content-between align-items-center flex-wrap mt-3">
            <div class="text-muted">
                Página @currentPage de @totalPages - Mostrando @Model.Count de @totalRecords registros
            </div>

            <nav aria-label="Page navigation">
                <ul class="pagination mb-0">
                    <!-- Primera página -->
                    <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = 1, pageSize = pageSize })">
                            &laquo;&laquo;
                        </a>
                    </li>

                    <!-- Página anterior -->
                    <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = currentPage - 1, pageSize = pageSize })">
                            &laquo;
                        </a>
                    </li>

                    @for (int i = startPage; i <= endPage; i++)
                    {
                        <li class="page-item @(i == currentPage ? "active" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { page = i, pageSize = pageSize })">@i</a>
                        </li>
                    }

                    <!-- Página siguiente -->
                    <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = currentPage + 1, pageSize = pageSize })">
                            &raquo;
                        </a>
                    </li>

                    <!-- Última página -->
                    <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = totalPages, pageSize = pageSize })">
                            &raquo;&raquo;
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    }

    <!-- Botón Crear Nuevo Cliente -->
    <div class="text-center mt-4">
        @Html.ActionLink("➕ Crear Nuevo Cliente", "CrearCliente", null,
            new { @class = "btn btn-success btn-lg" })
    </div>
</div>

@section Scripts {
    <script>
        // Redirigir URLs incorrectas
        if (window.location.pathname === '/Documentos/' && window.location.search) {
            var urlParams = new URLSearchParams(window.location.search);
            var clienteId = urlParams.get('clienteId');
            if (clienteId) {
                window.location.href = '/Documentos/Index?' + window.location.search;
            }
        }
    </script>
    <script>
        // Cambiar número de registros por página
        document.getElementById('pageSize').addEventListener('change', function() {
            var pageSize = this.value;
            window.location.href = '@Url.Action("Index")' + '?page=1&pageSize=' + pageSize;
        });
    </script>
}